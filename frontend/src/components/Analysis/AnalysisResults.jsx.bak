import React, { useState } from 'react';
import { 
  Shield, Eye, BookOpen, AlertTriangle, CheckCircle, 
  XCircle, Info, ChevronDown, ChevronUp, Target, 
  Zap, TrendingUp, ExternalLink, Download, FileText,
  Palette, Type, MousePointer, Image as ImageIcon,
  Layout, Contrast, FileWarning
} from 'lucide-react';

// Issue Card Component - Detailed expandable card for each issue
const IssueCard = ({ issue, category }) => {
  const [expanded, setExpanded] = useState(false);

  const getCategoryColor = (cat) => {
    switch (cat) {
      case 'accessibility':
        return {
          border: 'border-blue-200',
          bg: 'bg-blue-50',
          text: 'text-blue-700',
          iconBg: 'bg-blue-100'
        };
      case 'readability':
        return {
          border: 'border-green-200',
          bg: 'bg-green-50',
          text: 'text-green-700',
          iconBg: 'bg-green-100'
        };
      case 'attention':
        return {
          border: 'border-purple-200',
          bg: 'bg-purple-50',
          text: 'text-purple-700',
          iconBg: 'bg-purple-100'
        };
      default:
        return {
          border: 'border-gray-200',
          bg: 'bg-gray-50',
          text: 'text-gray-700',
          iconBg: 'bg-gray-100'
        };
    }
  };

  const getSeverityInfo = (severity) => {
    switch (severity) {
      case 'critical':
        return {
          icon: <XCircle className="h-5 w-5" />,
          color: 'text-red-600',
          bg: 'bg-red-100',
          border: 'border-red-300',
          label: 'Critical',
          emoji: 'üî¥'
        };
      case 'high':
        return {
          icon: <AlertTriangle className="h-5 w-5" />,
          color: 'text-orange-600',
          bg: 'bg-orange-100',
          border: 'border-orange-300',
          label: 'High',
          emoji: 'üü†'
        };
      case 'medium':
        return {
          icon: <Info className="h-5 w-5" />,
          color: 'text-yellow-600',
          bg: 'bg-yellow-100',
          border: 'border-yellow-300',
          label: 'Medium',
          emoji: 'üü°'
        };
      case 'low':
        return {
          icon: <Info className="h-5 w-5" />,
          color: 'text-blue-600',
          bg: 'bg-blue-100',
          border: 'border-blue-300',
          label: 'Low',
          emoji: 'üîµ'
        };
      default:
        return {
          icon: <Info className="h-5 w-5" />,
          color: 'text-gray-600',
          bg: 'bg-gray-100',
          border: 'border-gray-300',
          label: 'Info',
          emoji: '‚ö™'
        };
    }
  };

  const colors = getCategoryColor(category);
  const severity = getSeverityInfo(issue.severity);

  return (
    <div className={`border-2 ${colors.border} rounded-lg overflow-hidden bg-white shadow-sm hover:shadow-md transition-shadow`}>
      {/* Header */}
      <div className={`${colors.bg} p-4 border-b ${colors.border}`}>
        <div className="flex items-start justify-between gap-3">
          <div className="flex-1">
            <div className="flex items-center gap-2 mb-2">
              <span className={`inline-flex items-center gap-1 px-2 py-1 rounded text-xs font-semibold ${severity.bg} ${severity.color} ${severity.border} border`}>
                {severity.icon}
                {severity.emoji} {severity.label}
              </span>
              {issue.wcag_criterion && (
                <span className="inline-flex items-center gap-1 px-2 py-1 rounded text-xs font-mono bg-white border border-gray-300 text-gray-700">
                  <Shield className="h-3 w-3" />
                  WCAG {issue.wcag_criterion}
                </span>
              )}
            </div>
            <h3 className="text-lg font-bold text-gray-900">{issue.type || issue.title}</h3>
            <p className="text-sm text-gray-600 mt-1 capitalize">
              Category: {category}
            </p>
          </div>
          <button
            onClick={() => setExpanded(!expanded)}
            className={`p-2 rounded-lg ${colors.iconBg} ${colors.text} hover:opacity-80 transition-opacity`}
            aria-label={expanded ? 'Collapse details' : 'Expand details'}
          >
            {expanded ? <ChevronUp className="h-5 w-5" /> : <ChevronDown className="h-5 w-5" />}
          </button>
        </div>
      </div>

      {/* Collapsed Preview */}
      {!expanded && (
        <div className="p-4">
          <p className="text-sm text-gray-700 line-clamp-2">{issue.description}</p>
        </div>
      )}

      {/* Expanded Content */}
      {expanded && (
        <div className="p-4 space-y-4">
          {/* Location */}
          {issue.location && (
            <div>
              <div className="flex items-center gap-2 mb-2">
                <Target className="h-4 w-4 text-gray-500" />
                <h4 className="font-semibold text-sm text-gray-900">üìç Location</h4>
              </div>
              <p className="text-sm text-gray-700 bg-gray-50 p-2 rounded border border-gray-200 font-mono">
                {issue.location}
              </p>
            </div>
          )}

          {/* Current State */}
          {issue.current_state && (
            <div>
              <div className="flex items-center gap-2 mb-2">
                <FileWarning className="h-4 w-4 text-gray-500" />
                <h4 className="font-semibold text-sm text-gray-900">üîç Current State</h4>
              </div>
              <div className="bg-red-50 border border-red-200 p-3 rounded">
                <p className="text-sm text-gray-700">{issue.current_state}</p>
                {issue.current_value && (
                  <div className="mt-2 font-mono text-sm">
                    <span className="text-gray-600">Value: </span>
                    <span className="text-red-700 font-semibold">{issue.current_value}</span>
                  </div>
                )}
              </div>
            </div>
          )}

          {/* Problem */}
          <div>
            <div className="flex items-center gap-2 mb-2">
              <AlertTriangle className="h-4 w-4 text-orange-500" />
              <h4 className="font-semibold text-sm text-gray-900">‚ö†Ô∏è Problem</h4>
            </div>
            <p className="text-sm text-gray-700 bg-orange-50 p-3 rounded border border-orange-200">
              {issue.description}
            </p>
          </div>

          {/* Solution */}
          {issue.recommendation && (
            <div>
              <div className="flex items-center gap-2 mb-2">
                <CheckCircle className="h-4 w-4 text-green-500" />
                <h4 className="font-semibold text-sm text-gray-900">‚úÖ Solution</h4>
              </div>
              <div className="bg-green-50 border border-green-200 p-3 rounded">
                <p className="text-sm text-gray-700">{issue.recommendation}</p>
              </div>
            </div>
          )}

          {/* Before/After Preview */}
          {(issue.before_value || issue.after_value) && (
            <div>
              <div className="flex items-center gap-2 mb-2">
                <TrendingUp className="h-4 w-4 text-blue-500" />
                <h4 className="font-semibold text-sm text-gray-900">üí° Before/After Preview</h4>
              </div>
              <div className="grid grid-cols-2 gap-3">
                {issue.before_value && (
                  <div className="bg-red-50 border border-red-200 p-3 rounded">
                    <div className="text-xs text-gray-600 mb-1 font-semibold">Before</div>
                    <div className="font-mono text-sm text-red-700">{issue.before_value}</div>
                  </div>
                )}
                {issue.after_value && (
                  <div className="bg-green-50 border border-green-200 p-3 rounded">
                    <div className="text-xs text-gray-600 mb-1 font-semibold">After</div>
                    <div className="font-mono text-sm text-green-700">{issue.after_value}</div>
                  </div>
                )}
              </div>
            </div>
          )}

          {/* Impact */}
          {issue.impact && (
            <div>
              <div className="flex items-center gap-2 mb-2">
                <Zap className="h-4 w-4 text-purple-500" />
                <h4 className="font-semibold text-sm text-gray-900">üìä Impact</h4>
              </div>
              <div className="bg-purple-50 border border-purple-200 p-3 rounded space-y-2">
                {issue.impact.affects_percentage && (
                  <p className="text-sm">
                    <span className="text-gray-600">Affects: </span>
                    <span className="text-purple-700 font-semibold">{issue.impact.affects_percentage}% of users</span>
                  </p>
                )}
                {issue.impact.improvement && (
                  <p className="text-sm">
                    <span className="text-gray-600">Improvement: </span>
                    <span className="text-purple-700 font-semibold">{issue.impact.improvement}</span>
                  </p>
                )}
                {issue.impact.description && (
                  <p className="text-sm text-gray-700">{issue.impact.description}</p>
                )}
              </div>
            </div>
          )}

          {/* Effort */}
          {issue.effort && (
            <div className="flex items-center justify-between bg-gray-50 p-3 rounded border border-gray-200">
              <span className="text-sm text-gray-600 font-medium">‚è±Ô∏è Effort Required:</span>
              <span className={`px-3 py-1 rounded-full text-sm font-semibold ${
                issue.effort === 'low' ? 'bg-green-100 text-green-700' :
                issue.effort === 'medium' ? 'bg-yellow-100 text-yellow-700' :
                'bg-red-100 text-red-700'
              }`}>
                {issue.effort.charAt(0).toUpperCase() + issue.effort.slice(1)}
              </span>
            </div>
          )}

          {/* Learn More */}
          {issue.learn_more_url && (
            <div>
              <a
                href={issue.learn_more_url}
                target="_blank"
                rel="noopener noreferrer"
                className="inline-flex items-center gap-2 text-sm text-blue-600 hover:text-blue-700 font-medium"
              >
                <ExternalLink className="h-4 w-4" />
                üîó Learn More
              </a>
            </div>
          )}
        </div>
      )}
    </div>
  );
};

// Priority Fix Card Component
const PriorityFixCard = ({ fix, rank }) => {
  const getSeverityColor = (severity) => {
    switch (severity) {
      case 'critical':
        return { bg: 'bg-red-100', border: 'border-red-300', text: 'text-red-700', emoji: 'üî¥' };
      case 'high':
        return { bg: 'bg-orange-100', border: 'border-orange-300', text: 'text-orange-700', emoji: 'üü†' };
      case 'medium':
        return { bg: 'bg-yellow-100', border: 'border-yellow-300', text: 'text-yellow-700', emoji: 'üü°' };
      default:
        return { bg: 'bg-blue-100', border: 'border-blue-300', text: 'text-blue-700', emoji: 'üîµ' };
    }
  };

  const getEffortColor = (effort) => {
    switch (effort) {
      case 'low':
        return 'text-green-600';
      case 'medium':
        return 'text-yellow-600';
      case 'high':
        return 'text-red-600';
      default:
        return 'text-gray-600';
    }
  };

  const getImpactColor = (impact) => {
    switch (impact) {
      case 'high':
        return 'text-purple-600';
      case 'medium':
        return 'text-blue-600';
      case 'low':
        return 'text-gray-600';
      default:
        return 'text-gray-600';
    }
  };

  const colors = getSeverityColor(fix.severity);

  return (
    <div className={`border-2 ${colors.border} rounded-lg p-4 ${colors.bg} hover:shadow-lg transition-shadow`}>
      <div className="flex items-start gap-3">
        <div className={`flex-shrink-0 w-8 h-8 rounded-full bg-white border-2 ${colors.border} flex items-center justify-center font-bold ${colors.text}`}>
          {rank}
        </div>
        <div className="flex-1">
          <div className="flex items-start justify-between gap-2 mb-2">
            <h4 className="font-bold text-gray-900 text-sm flex items-center gap-2">
              {colors.emoji} {fix.title}
            </h4>
          </div>
          <div className="flex flex-wrap items-center gap-2 text-xs mb-2">
            <span className={`font-semibold ${getImpactColor(fix.impact)}`}>
              Impact: {fix.impact ? fix.impact.charAt(0).toUpperCase() + fix.impact.slice(1) : 'Unknown'}
            </span>
            <span className="text-gray-400">|</span>
            <span className={`font-semibold ${getEffortColor(fix.effort)}`}>
              Effort: {fix.effort ? fix.effort.charAt(0).toUpperCase() + fix.effort.slice(1) : 'Unknown'}
            </span>
            {fix.wcag && (
              <>
                <span className="text-gray-400">|</span>
                <span className="font-mono text-gray-700">{fix.wcag}</span>
              </>
            )}
          </div>
          <p className="text-sm text-gray-700">{fix.description}</p>
        </div>
      </div>
    </div>
  );
};

const AnalysisResults = ({ results }) => {
  const [activeTab, setActiveTab] = useState('summary');

  if (!results) {
    return (
      <div className="flex items-center justify-center p-12">
        <p className="text-gray-500">No analysis results to display</p>
      </div>
    );
  }

  const { 
    arai_score, 
    overall_grade, 
    accessibility, 
    readability, 
    attention,
    conformance_level 
  } = results;

  // Calculate total issues
  const getTotalIssues = (analysis) => {
    if (!analysis?.issue_count) return 0;
    return (
      (analysis.issue_count.critical || 0) +
      (analysis.issue_count.high || 0) +
      (analysis.issue_count.medium || 0) +
      (analysis.issue_count.low || 0)
    );
  };

  const totalIssues = 
    getTotalIssues(accessibility) +
    getTotalIssues(readability) +
    getTotalIssues(attention);

  // Generate priority fixes from all issues
  const generatePriorityFixes = () => {
    const allIssues = [];

    // Add accessibility issues
    if (accessibility?.issues) {
      accessibility.issues.forEach(issue => {
        allIssues.push({
          ...issue,
          category: 'accessibility',
          impact: issue.severity === 'critical' ? 'high' : issue.severity === 'high' ? 'high' : 'medium',
          effort: 'low',
          wcag: issue.wcag_criterion
        });
      });
    }

    // Add readability issues
    if (readability?.issues) {
      readability.issues.forEach(issue => {
        allIssues.push({
          ...issue,
          category: 'readability',
          impact: issue.severity === 'critical' ? 'high' : 'medium',
          effort: 'medium'
        });
      });
    }

    // Add attention issues
    if (attention?.issues) {
      attention.issues.forEach(issue => {
        allIssues.push({
          ...issue,
          category: 'attention',
          impact: 'high',
          effort: 'low'
        });
      });
    }

    // Sort by severity
    const severityOrder = { critical: 0, high: 1, medium: 2, low: 3 };
    allIssues.sort((a, b) => severityOrder[a.severity] - severityOrder[b.severity]);

    return allIssues.slice(0, 5).map(issue => ({
      title: issue.type || issue.title,
      description: issue.description,
      severity: issue.severity,
      impact: issue.impact,
      effort: issue.effort,
      wcag: issue.wcag
    }));
  };

  const priorityFixes = generatePriorityFixes();

  // Get score color
  const getScoreColor = (score) => {
    if (score >= 90) return 'text-green-600';
    if (score >= 80) return 'text-blue-600';
    if (score >= 70) return 'text-yellow-600';
    if (score >= 60) return 'text-orange-600';
    return 'text-red-600';
  };

  // Get score status
  const getScoreStatus = (score) => {
    if (score >= 90) return { emoji: '‚úÖ', label: 'Excellent', color: 'text-green-600' };
    if (score >= 70) return { emoji: '‚ö†Ô∏è', label: 'Needs Improvement', color: 'text-yellow-600' };
    return { emoji: '‚ùå', label: 'Critical Issues', color: 'text-red-600' };
  };

  // Get grade badge color
  const getGradeBadgeColor = (grade) => {
    if (grade === 'A') return 'bg-green-100 text-green-800 border-green-300';
    if (grade === 'B') return 'bg-blue-100 text-blue-800 border-blue-300';
    if (grade === 'C') return 'bg-yellow-100 text-yellow-800 border-yellow-300';
    if (grade === 'D') return 'bg-orange-100 text-orange-800 border-orange-300';
    return 'bg-red-100 text-red-800 border-red-300';
  };


  return (
    <div className="max-w-7xl mx-auto p-6 space-y-6">
      {/* Overall Score Dashboard */}
      <div className="bg-white rounded-xl shadow-xl border-2 border-gray-200 overflow-hidden">
        <div className="bg-gradient-to-r from-blue-600 to-purple-600 p-8 text-white">
          <div className="flex items-start justify-between">
            <div className="flex-1">
              <h1 className="text-3xl font-bold mb-2">
                {results.design_name || 'Design Analysis Report'}
              </h1>
              <p className="text-blue-100 text-sm">
                Comprehensive AI-Powered Accessibility Analysis
              </p>
            </div>
            <div className="text-center bg-white bg-opacity-20 rounded-xl p-6 backdrop-blur-sm">
              <div className="text-sm text-blue-100 mb-1">Overall Score</div>
              <div className="text-6xl font-bold mb-2">
                {arai_score || 0}
              </div>
              <div className={`inline-block px-4 py-2 rounded-full text-xl font-bold border-2 ${getGradeBadgeColor(overall_grade)}`}>
                Grade {overall_grade}
              </div>
            </div>
          </div>
        </div>

        {/* Score Breakdown Cards */}
        <div className="grid grid-cols-1 md:grid-cols-3 gap-6 p-6">
          {/* Accessibility */}
          <div className="bg-gradient-to-br from-blue-50 to-blue-100 rounded-xl p-6 border-2 border-blue-200">
            <div className="flex items-center gap-3 mb-4">
              <div className="p-3 bg-blue-600 rounded-lg">
                <Shield className="h-6 w-6 text-white" />
              </div>
              <div>
                <h3 className="font-bold text-gray-900">üé® Accessibility</h3>
                <p className="text-xs text-gray-600">WCAG 2.1 Compliance</p>
              </div>
            </div>
            <div className={`text-5xl font-bold mb-2 ${getScoreColor(accessibility?.score || 0)}`}>
              {accessibility?.score || 0}<span className="text-2xl">/100</span>
            </div>
            <div className="flex items-center gap-2 mb-3">
              <div className="flex-1 h-3 bg-white rounded-full overflow-hidden border border-blue-300">
                <div 
                  className="h-full bg-blue-600 transition-all duration-500"
                  style={{ width: `${accessibility?.score || 0}%` }}
                />
              </div>
            </div>
            {accessibility?.issue_count && (
              <div className="grid grid-cols-4 gap-1 text-center text-xs">
                <div>
                  <div className="font-bold text-red-600">{accessibility.issue_count.critical || 0}</div>
                  <div className="text-gray-600">Critical</div>
                </div>
                <div>
                  <div className="font-bold text-orange-600">{accessibility.issue_count.high || 0}</div>
                  <div className="text-gray-600">High</div>
                </div>
                <div>
                  <div className="font-bold text-yellow-600">{accessibility.issue_count.medium || 0}</div>
                  <div className="text-gray-600">Medium</div>
                </div>
                <div>
                  <div className="font-bold text-blue-600">{accessibility.issue_count.low || 0}</div>
                  <div className="text-gray-600">Low</div>
                </div>
              </div>
            )}
          </div>

          {/* Readability */}
          <div className="bg-gradient-to-br from-green-50 to-green-100 rounded-xl p-6 border-2 border-green-200">
            <div className="flex items-center gap-3 mb-4">
              <div className="p-3 bg-green-600 rounded-lg">
                <BookOpen className="h-6 w-6 text-white" />
              </div>
              <div>
                <h3 className="font-bold text-gray-900">üìñ Readability</h3>
                <p className="text-xs text-gray-600">Text Clarity & Quality</p>
              </div>
            </div>
            <div className={`text-5xl font-bold mb-2 ${getScoreColor(readability?.score || 0)}`}>
              {readability?.score || 0}<span className="text-2xl">/100</span>
            </div>
            <div className="flex items-center gap-2 mb-3">
              <div className="flex-1 h-3 bg-white rounded-full overflow-hidden border border-green-300">
                <div 
                  className="h-full bg-green-600 transition-all duration-500"
                  style={{ width: `${readability?.score || 0}%` }}
                />
              </div>
            </div>
            {readability?.issue_count && (
              <div className="grid grid-cols-4 gap-1 text-center text-xs">
                <div>
                  <div className="font-bold text-red-600">{readability.issue_count.critical || 0}</div>
                  <div className="text-gray-600">Critical</div>
                </div>
                <div>
                  <div className="font-bold text-orange-600">{readability.issue_count.high || 0}</div>
                  <div className="text-gray-600">High</div>
                </div>
                <div>
                  <div className="font-bold text-yellow-600">{readability.issue_count.medium || 0}</div>
                  <div className="text-gray-600">Medium</div>
                </div>
                <div>
                  <div className="font-bold text-blue-600">{readability.issue_count.low || 0}</div>
                  <div className="text-gray-600">Low</div>
                </div>
              </div>
            )}
          </div>

          {/* Attention */}
          <div className="bg-gradient-to-br from-purple-50 to-purple-100 rounded-xl p-6 border-2 border-purple-200">
            <div className="flex items-center gap-3 mb-4">
              <div className="p-3 bg-purple-600 rounded-lg">
                <Eye className="h-6 w-6 text-white" />
              </div>
              <div>
                <h3 className="font-bold text-gray-900">üëÅÔ∏è Attention</h3>
                <p className="text-xs text-gray-600">Visual Hierarchy</p>
              </div>
            </div>
            <div className={`text-5xl font-bold mb-2 ${getScoreColor(attention?.score || 0)}`}>
              {attention?.score || 0}<span className="text-2xl">/100</span>
            </div>
            <div className="flex items-center gap-2 mb-3">
              <div className="flex-1 h-3 bg-white rounded-full overflow-hidden border border-purple-300">
                <div 
                  className="h-full bg-purple-600 transition-all duration-500"
                  style={{ width: `${attention?.score || 0}%` }}
                />
              </div>
            </div>
            {attention?.issue_count && (
              <div className="grid grid-cols-4 gap-1 text-center text-xs">
                <div>
                  <div className="font-bold text-red-600">{attention.issue_count.critical || 0}</div>
                  <div className="text-gray-600">Critical</div>
                </div>
                <div>
                  <div className="font-bold text-orange-600">{attention.issue_count.high || 0}</div>
                  <div className="text-gray-600">High</div>
                </div>
                <div>
                  <div className="font-bold text-yellow-600">{attention.issue_count.medium || 0}</div>
                  <div className="text-gray-600">Medium</div>
                </div>
                <div>
                  <div className="font-bold text-blue-600">{attention.issue_count.low || 0}</div>
                  <div className="text-gray-600">Low</div>
                </div>
              </div>
            )}
          </div>
        </div>

        {/* Status Summary */}
        <div className="border-t-2 border-gray-200 p-6 bg-gray-50">
          <div className="flex items-center justify-between">
            <div>
              <div className="text-sm text-gray-600 mb-1">Overall Status</div>
              <div className={`text-2xl font-bold ${getScoreStatus(arai_score).color}`}>
                {getScoreStatus(arai_score).emoji} {getScoreStatus(arai_score).label}
              </div>
            </div>
            <div className="text-right">
              <div className="text-sm text-gray-600 mb-1">Total Issues Found</div>
              <div className="text-3xl font-bold text-gray-900">{totalIssues}</div>
            </div>
            {conformance_level && (
              <div className="text-right">
                <div className="text-sm text-gray-600 mb-1">WCAG Level</div>
                <div className="text-2xl font-bold text-blue-600">{conformance_level}</div>
              </div>
            )}
          </div>
        </div>
      </div>

      {/* Top Priority Fixes */}
      {priorityFixes.length > 0 && (
        <div className="bg-white rounded-xl shadow-lg border-2 border-gray-200 p-6">
          <div className="flex items-center gap-3 mb-6">
            <Target className="h-8 w-8 text-red-600" />
            <div>
              <h2 className="text-2xl font-bold text-gray-900">üéØ Top 5 Priority Fixes</h2>
              <p className="text-sm text-gray-600">Address these issues first for maximum impact</p>
            </div>
          </div>
          <div className="space-y-3">
            {priorityFixes.map((fix, idx) => (
              <PriorityFixCard key={idx} fix={fix} rank={idx + 1} />
            ))}
          </div>
        </div>
      )}

      {/* Tab Navigation */}
      <div className="bg-white rounded-xl shadow-lg border-2 border-gray-200 overflow-hidden">
        <div className="border-b-2 border-gray-200 bg-gray-50">
          <div className="flex">
            <button
              onClick={() => setActiveTab('summary')}
              className={`flex-1 px-6 py-4 font-semibold text-sm transition-colors ${
                activeTab === 'summary'
                  ? 'bg-white text-blue-600 border-b-4 border-blue-600'
                  : 'text-gray-600 hover:text-gray-900 hover:bg-gray-100'
              }`}
            >
              <div className="flex items-center justify-center gap-2">
                <FileText className="h-5 w-5" />
                Summary View
              </div>
            </button>
            <button
              onClick={() => setActiveTab('accessibility')}
              className={`flex-1 px-6 py-4 font-semibold text-sm transition-colors ${
                activeTab === 'accessibility'
                  ? 'bg-white text-blue-600 border-b-4 border-blue-600'
                  : 'text-gray-600 hover:text-gray-900 hover:bg-gray-100'
              }`}
            >
              <div className="flex items-center justify-center gap-2">
                <Shield className="h-5 w-5" />
                Accessibility Details
              </div>
            </button>
            <button
              onClick={() => setActiveTab('readability')}
              className={`flex-1 px-6 py-4 font-semibold text-sm transition-colors ${
                activeTab === 'readability'
                  ? 'bg-white text-green-600 border-b-4 border-green-600'
                  : 'text-gray-600 hover:text-gray-900 hover:bg-gray-100'
              }`}
            >
              <div className="flex items-center justify-center gap-2">
                <BookOpen className="h-5 w-5" />
                Readability Details
              </div>
            </button>
            <button
              onClick={() => setActiveTab('attention')}
              className={`flex-1 px-6 py-4 font-semibold text-sm transition-colors ${
                activeTab === 'attention'
                  ? 'bg-white text-purple-600 border-b-4 border-purple-600'
                  : 'text-gray-600 hover:text-gray-900 hover:bg-gray-100'
              }`}
            >
              <div className="flex items-center justify-center gap-2">
                <Eye className="h-5 w-5" />
                Attention Details
              </div>
            </button>
          </div>
        </div>

        {/* Tab Content */}
        <div className="p-6">
          {/* Summary Tab */}
          {activeTab === 'summary' && (
            <div className="space-y-6">
              <div className="prose max-w-none">
                <h3 className="text-xl font-bold text-gray-900 mb-4">Analysis Summary</h3>
                <p className="text-gray-700">
                  This comprehensive analysis evaluates your design across three critical dimensions:
                  accessibility, readability, and visual attention. Each dimension is scored out of 100,
                  with issues categorized by severity to help you prioritize improvements.
                </p>
              </div>

              {/* Quick Stats Grid */}
              <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
                <div className="bg-blue-50 border-2 border-blue-200 rounded-lg p-6">
                  <div className="flex items-center gap-3 mb-3">
                    <Palette className="h-6 w-6 text-blue-600" />
                    <h4 className="font-bold text-gray-900">Accessibility</h4>
                  </div>
                  <ul className="space-y-2 text-sm text-gray-700">
                    <li className="flex items-center gap-2">
                      <Contrast className="h-4 w-4 text-blue-600" />
                      Color contrast ratios
                    </li>
                    <li className="flex items-center gap-2">
                      <Type className="h-4 w-4 text-blue-600" />
                      Text size & readability
                    </li>
                    <li className="flex items-center gap-2">
                      <MousePointer className="h-4 w-4 text-blue-600" />
                      Touch target sizes
                    </li>
                    <li className="flex items-center gap-2">
                      <ImageIcon className="h-4 w-4 text-blue-600" />
                      Image alt text
                    </li>
                  </ul>
                </div>

                <div className="bg-green-50 border-2 border-green-200 rounded-lg p-6">
                  <div className="flex items-center gap-3 mb-3">
                    <BookOpen className="h-6 w-6 text-green-600" />
                    <h4 className="font-bold text-gray-900">Readability</h4>
                  </div>
                  <ul className="space-y-2 text-sm text-gray-700">
                    <li>‚Ä¢ Text complexity analysis</li>
                    <li>‚Ä¢ Sentence length optimization</li>
                    <li>‚Ä¢ Typography & line spacing</li>
                    <li>‚Ä¢ Inclusive language check</li>
                  </ul>
                </div>

                <div className="bg-purple-50 border-2 border-purple-200 rounded-lg p-6">
                  <div className="flex items-center gap-3 mb-3">
                    <Eye className="h-6 w-6 text-purple-600" />
                    <h4 className="font-bold text-gray-900">Attention</h4>
                  </div>
                  <ul className="space-y-2 text-sm text-gray-700">
                    <li>‚Ä¢ Visual hierarchy analysis</li>
                    <li>‚Ä¢ Heatmap attention flow</li>
                    <li>‚Ä¢ CTA visibility</li>
                    <li>‚Ä¢ Cognitive load assessment</li>
                  </ul>
                </div>
              </div>

              {/* Action Items */}
              <div className="bg-gradient-to-r from-orange-50 to-red-50 border-2 border-orange-200 rounded-lg p-6">
                <h4 className="font-bold text-gray-900 mb-3 flex items-center gap-2">
                  <AlertTriangle className="h-5 w-5 text-orange-600" />
                  Recommended Next Steps
                </h4>
                <ol className="space-y-2 ml-6 list-decimal text-gray-700">
                  <li>Review and address all <span className="font-semibold text-red-600">Critical</span> issues first</li>
                  <li>Focus on high-impact, low-effort fixes for quick wins</li>
                  <li>Test changes with actual users, especially those with disabilities</li>
                  <li>Use the detailed tabs below to explore each category</li>
                  <li>Export this report and share with your team</li>
                </ol>
              </div>

              {/* Export Options */}
              <div className="flex items-center gap-3">
                <button className="flex items-center gap-2 px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-semibold">
                  <Download className="h-5 w-5" />
                  Export as PDF
                </button>
                <button className="flex items-center gap-2 px-6 py-3 bg-white text-gray-700 border-2 border-gray-300 rounded-lg hover:bg-gray-50 transition-colors font-semibold">
                  <FileText className="h-5 w-5" />
                  View Detailed Report
                </button>
              </div>
            </div>
          )}

          {/* Accessibility Tab */}
          {activeTab === 'accessibility' && (
            <div className="space-y-6">
              <div className="flex items-center justify-between mb-6">
                <div>
                  <h3 className="text-2xl font-bold text-gray-900">üé® Accessibility Analysis</h3>
                  <p className="text-gray-600">WCAG 2.1 Compliance Check</p>
                </div>
                {accessibility?.conformance_level && (
                  <div className="text-right">
                    <div className="text-sm text-gray-600">Conformance Level</div>
                    <div className="text-3xl font-bold text-blue-600">{accessibility.conformance_level}</div>
                  </div>
                )}
              </div>

              {accessibility?.issues && accessibility.issues.length > 0 ? (
                <div className="space-y-4">
                  {accessibility.issues.map((issue, idx) => (
                    <IssueCard key={idx} issue={issue} category="accessibility" />
                  ))}
                </div>
              ) : (
                <div className="text-center py-12 bg-green-50 border-2 border-green-200 rounded-lg">
                  <CheckCircle className="h-16 w-16 mx-auto mb-4 text-green-500" />
                  <h4 className="text-xl font-bold text-gray-900 mb-2">Great Job!</h4>
                  <p className="text-gray-600">No accessibility issues found in this design.</p>
                </div>
              )}
            </div>
          )}

          {/* Readability Tab */}
          {activeTab === 'readability' && (
            <div className="space-y-6">
              <div className="flex items-center justify-between mb-6">
                <div>
                  <h3 className="text-2xl font-bold text-gray-900">üìñ Readability Analysis</h3>
                  <p className="text-gray-600">Text Clarity & Quality Assessment</p>
                </div>
              </div>

              {/* Readability Metrics */}
              {readability?.metrics && (
                <div className="bg-green-50 border-2 border-green-200 rounded-lg p-6 mb-6">
                  <h4 className="font-bold text-gray-900 mb-4">üìä Readability Metrics</h4>
                  <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
                    {readability.metrics.flesch_reading_ease !== undefined && (
                      <div className="bg-white p-4 rounded-lg border border-green-300">
                        <div className="text-sm text-gray-600 mb-1">Reading Ease</div>
                        <div className="text-2xl font-bold text-green-700">
                          {readability.metrics.flesch_reading_ease.toFixed(1)}
                        </div>
                        <div className="text-xs text-gray-500 mt-1">
                          {readability.metrics.flesch_reading_ease >= 60 ? 'Easy' : 
                           readability.metrics.flesch_reading_ease >= 30 ? 'Moderate' : 'Difficult'}
                        </div>
                      </div>
                    )}
                    {readability.metrics.flesch_kincaid_grade !== undefined && (
                      <div className="bg-white p-4 rounded-lg border border-green-300">
                        <div className="text-sm text-gray-600 mb-1">Grade Level</div>
                        <div className="text-2xl font-bold text-green-700">
                          {readability.metrics.flesch_kincaid_grade.toFixed(1)}
                        </div>
                        <div className="text-xs text-gray-500 mt-1">
                          Grade {Math.round(readability.metrics.flesch_kincaid_grade)}
                        </div>
                      </div>
                    )}
                    {readability.metrics.word_count !== undefined && (
                      <div className="bg-white p-4 rounded-lg border border-green-300">
                        <div className="text-sm text-gray-600 mb-1">Word Count</div>
                        <div className="text-2xl font-bold text-green-700">
                          {readability.metrics.word_count}
                        </div>
                        <div className="text-xs text-gray-500 mt-1">Total words</div>
                      </div>
                    )}
                    {readability.metrics.avg_line_length !== undefined && (
                      <div className="bg-white p-4 rounded-lg border border-green-300">
                        <div className="text-sm text-gray-600 mb-1">Avg Line Length</div>
                        <div className="text-2xl font-bold text-green-700">
                          {readability.metrics.avg_line_length.toFixed(0)}
                        </div>
                        <div className="text-xs text-gray-500 mt-1">
                          {readability.metrics.avg_line_length <= 75 ? 'Optimal' : 'Too long'}
                        </div>
                      </div>
                    )}
                  </div>
                </div>
              )}

              {readability?.issues && readability.issues.length > 0 ? (
                <div className="space-y-4">
                  {readability.issues.map((issue, idx) => (
                    <IssueCard key={idx} issue={issue} category="readability" />
                  ))}
                </div>
              ) : (
                <div className="text-center py-12 bg-green-50 border-2 border-green-200 rounded-lg">
                  <CheckCircle className="h-16 w-16 mx-auto mb-4 text-green-500" />
                  <h4 className="text-xl font-bold text-gray-900 mb-2">Excellent Readability!</h4>
                  <p className="text-gray-600">Your text content is clear and easy to read.</p>
                </div>
              )}
            </div>
          )}

          {/* Attention Tab */}
          {activeTab === 'attention' && (
            <div className="space-y-6">
              <div className="flex items-center justify-between mb-6">
                <div>
                  <h3 className="text-2xl font-bold text-gray-900">üëÅÔ∏è Visual Attention Analysis</h3>
                  <p className="text-gray-600">Visual Hierarchy & User Focus</p>
                </div>
              </div>

              {/* Attention Distribution */}
              {attention?.attention_distribution && (
                <div className="bg-purple-50 border-2 border-purple-200 rounded-lg p-6 mb-6">
                  <h4 className="font-bold text-gray-900 mb-4">üéØ Attention Distribution</h4>
                  <div className="grid grid-cols-3 gap-4">
                    <div className="bg-white p-4 rounded-lg border border-purple-300 text-center">
                      <div className="text-sm text-gray-600 mb-2">Top Section</div>
                      <div className="text-3xl font-bold text-purple-700">
                        {(attention.attention_distribution.top * 100).toFixed(0)}%
                      </div>
                      <div className="mt-2 text-xs text-gray-500">
                        {attention.attention_distribution.top >= 0.6 ? '‚úì Optimal' : '‚ö†Ô∏è Low attention'}
                      </div>
                    </div>
                    <div className="bg-white p-4 rounded-lg border border-purple-300 text-center">
                      <div className="text-sm text-gray-600 mb-2">Center Section</div>
                      <div className="text-3xl font-bold text-purple-700">
                        {(attention.attention_distribution.center * 100).toFixed(0)}%
                      </div>
                      <div className="mt-2 text-xs text-gray-500">Middle area</div>
                    </div>
                    <div className="bg-white p-4 rounded-lg border border-purple-300 text-center">
                      <div className="text-sm text-gray-600 mb-2">Bottom Section</div>
                      <div className="text-3xl font-bold text-purple-700">
                        {(attention.attention_distribution.bottom * 100).toFixed(0)}%
                      </div>
                      <div className="mt-2 text-xs text-gray-500">
                        {attention.attention_distribution.bottom <= 0.1 ? '‚úì Expected' : 'High attention'}
                      </div>
                    </div>
                  </div>
                  {attention.analysis_summary && (
                    <div className="mt-4 p-4 bg-white rounded-lg border border-purple-300">
                      <p className="text-sm text-gray-700">{attention.analysis_summary}</p>
                    </div>
                  )}
                </div>
              )}

              {attention?.issues && attention.issues.length > 0 ? (
                <div className="space-y-4">
                  {attention.issues.map((issue, idx) => (
                    <IssueCard key={idx} issue={issue} category="attention" />
                  ))}
                </div>
              ) : (
                <div className="text-center py-12 bg-purple-50 border-2 border-purple-200 rounded-lg">
                  <CheckCircle className="h-16 w-16 mx-auto mb-4 text-purple-500" />
                  <h4 className="text-xl font-bold text-gray-900 mb-2">Perfect Visual Hierarchy!</h4>
                  <p className="text-gray-600">Your design effectively guides user attention.</p>
                </div>
              )}
            </div>
          )}
        </div>
      </div>
    </div>
  );
};

export default AnalysisResults;

                <div className="text-xs text-yellow-700 font-medium">Medium</div>
              </div>
              <div className="text-center p-3 bg-blue-50 rounded-lg border border-blue-200">
                <div className="text-2xl font-bold text-blue-600">
                  {accessibility.issue_count.low || 0}
                </div>
                <div className="text-xs text-blue-700 font-medium">Low</div>
              </div>
            </div>
          )}

          {/* Issues */}
          <div className="flex-1 overflow-y-auto max-h-96">
            <h3 className="font-semibold text-gray-900 mb-3 text-sm">Issues Found</h3>
            {accessibility?.issues && accessibility.issues.length > 0 ? (
              <div className="space-y-2">
                {accessibility.issues.map((issue, idx) => (
                  <div key={idx} className="p-3 border border-gray-200 rounded-lg bg-gray-50">
                    <div className="flex items-start gap-2 mb-1">
                      {getSeverityIcon(issue.severity)}
                      <h4 className="font-semibold text-sm text-gray-900 flex-1">{issue.type}</h4>
                    </div>
                    {issue.wcag_criterion && (
                      <span className="inline-block px-2 py-1 text-xs font-mono bg-blue-100 text-blue-700 rounded mb-1">
                        WCAG {issue.wcag_criterion}
                      </span>
                    )}
                    <p className="text-xs text-gray-700 mt-1">{issue.description}</p>
                    {issue.recommendation && (
                      <p className="text-xs text-blue-600 mt-1 font-medium">
                        üí° {issue.recommendation}
                      </p>
                    )}
                  </div>
                ))}
              </div>
            ) : (
              <div className="text-center py-6 text-gray-500">
                <CheckCircle className="h-8 w-8 mx-auto mb-2 text-green-500" />
                <p className="text-sm">No issues found!</p>
              </div>
            )}
          </div>

          {/* Recommendations */}
          {accessibility?.recommendations && accessibility.recommendations.length > 0 && (
            <div className="mt-4 pt-4 border-t border-gray-200">
              <h3 className="font-semibold text-gray-900 mb-2 text-sm">Recommendations</h3>
              <div className="space-y-2">
                {accessibility.recommendations.map((rec, idx) => (
                  <div key={idx} className="p-2 bg-blue-50 border border-blue-200 rounded text-xs">
                    <p className="font-semibold text-gray-900">{typeof rec === 'object' ? rec.title : rec}</p>
                    {typeof rec === 'object' && rec.description && (
                      <p className="text-gray-700 mt-1">{rec.description}</p>
                    )}
                  </div>
                ))}
              </div>
            </div>
          )}
        </div>

        {/* READABILITY COLUMN */}
        <div className="bg-white rounded-lg shadow-lg p-6 flex flex-col">
          <div className="flex items-center gap-3 mb-4 pb-4 border-b-2 border-green-200">
            <div className="p-3 bg-green-100 rounded-lg">
              <BookOpen className="h-6 w-6 text-green-600" />
            </div>
            <div>
              <h2 className="text-xl font-bold text-gray-900">Readability</h2>
              <p className="text-xs text-gray-500">Text Clarity & Quality</p>
            </div>
          </div>

          {/* Metrics */}
          {readability?.metrics && (
            <div className="grid grid-cols-2 gap-2 mb-4">
              {readability.metrics.flesch_reading_ease !== undefined && (
                <div className="p-3 bg-green-50 rounded-lg">
                  <div className="text-xs text-gray-600 mb-1">Reading Ease</div>
                  <div className="text-xl font-bold text-green-700">
                    {readability.metrics.flesch_reading_ease.toFixed(1)}
                  </div>
                </div>
              )}
              {readability.metrics.flesch_kincaid_grade !== undefined && (
                <div className="p-3 bg-green-50 rounded-lg">
                  <div className="text-xs text-gray-600 mb-1">Grade Level</div>
                  <div className="text-xl font-bold text-green-700">
                    {readability.metrics.flesch_kincaid_grade.toFixed(1)}
                  </div>
                </div>
              )}
              {readability.metrics.word_count !== undefined && (
                <div className="p-3 bg-green-50 rounded-lg">
                  <div className="text-xs text-gray-600 mb-1">Words</div>
                  <div className="text-xl font-bold text-green-700">
                    {readability.metrics.word_count}
                  </div>
                </div>
              )}
              {readability.metrics.avg_line_length !== undefined && (
                <div className="p-3 bg-green-50 rounded-lg">
                  <div className="text-xs text-gray-600 mb-1">Avg Line</div>
                  <div className="text-xl font-bold text-green-700">
                    {readability.metrics.avg_line_length.toFixed(0)}
                  </div>
                </div>
              )}
            </div>
          )}

          {/* Issues */}
          <div className="flex-1 overflow-y-auto max-h-96">
            <h3 className="font-semibold text-gray-900 mb-3 text-sm">Issues Found</h3>
            {readability?.issues && readability.issues.length > 0 ? (
              <div className="space-y-2">
                {readability.issues.map((issue, idx) => (
                  <div key={idx} className="p-3 border border-gray-200 rounded-lg bg-gray-50">
                    <div className="flex items-start gap-2 mb-1">
                      {getSeverityIcon(issue.severity)}
                      <h4 className="font-semibold text-sm text-gray-900 flex-1">{issue.type}</h4>
                    </div>
                    <p className="text-xs text-gray-700 mt-1">{issue.description}</p>
                    {issue.recommendation && (
                      <p className="text-xs text-green-600 mt-1 font-medium">
                        üí° {issue.recommendation}
                      </p>
                    )}
                  </div>
                ))}
              </div>
            ) : (
              <div className="text-center py-6 text-gray-500">
                <CheckCircle className="h-8 w-8 mx-auto mb-2 text-green-500" />
                <p className="text-sm">No issues found!</p>
              </div>
            )}
          </div>

          {/* Recommendations */}
          {readability?.recommendations && readability.recommendations.length > 0 && (
            <div className="mt-4 pt-4 border-t border-gray-200">
              <h3 className="font-semibold text-gray-900 mb-2 text-sm">Recommendations</h3>
              <div className="space-y-2">
                {readability.recommendations.map((rec, idx) => (
                  <div key={idx} className="p-2 bg-green-50 border border-green-200 rounded text-xs">
                    <p className="font-semibold text-gray-900">{typeof rec === 'object' ? rec.title : rec}</p>
                    {typeof rec === 'object' && rec.description && (
                      <p className="text-gray-700 mt-1">{rec.description}</p>
                    )}
                  </div>
                ))}
              </div>
            </div>
          )}
        </div>

        {/* ATTENTION COLUMN */}
        <div className="bg-white rounded-lg shadow-lg p-6 flex flex-col">
          <div className="flex items-center gap-3 mb-4 pb-4 border-b-2 border-purple-200">
            <div className="p-3 bg-purple-100 rounded-lg">
              <Eye className="h-6 w-6 text-purple-600" />
            </div>
            <div>
              <h2 className="text-xl font-bold text-gray-900">Attention</h2>
              <p className="text-xs text-gray-500">Visual Hierarchy</p>
            </div>
          </div>

          {/* Distribution */}
          {attention?.attention_distribution && (
            <div className="grid grid-cols-3 gap-2 mb-4">
              <div className="p-3 bg-purple-50 rounded-lg">
                <div className="text-xs text-gray-600 mb-1">Top</div>
                <div className="text-xl font-bold text-purple-700">
                  {(attention.attention_distribution.top * 100).toFixed(0)}%
                </div>
              </div>
              <div className="p-3 bg-purple-50 rounded-lg">
                <div className="text-xs text-gray-600 mb-1">Center</div>
                <div className="text-xl font-bold text-purple-700">
                  {(attention.attention_distribution.center * 100).toFixed(0)}%
                </div>
              </div>
              <div className="p-3 bg-purple-50 rounded-lg">
                <div className="text-xs text-gray-600 mb-1">Bottom</div>
                <div className="text-xl font-bold text-purple-700">
                  {(attention.attention_distribution.bottom * 100).toFixed(0)}%
                </div>
              </div>
            </div>
          )}

          {attention?.analysis_summary && (
            <div className="mb-4 p-3 bg-purple-50 rounded-lg">
              <p className="text-xs text-gray-700">{attention.analysis_summary}</p>
            </div>
          )}

          {/* Issues */}
          <div className="flex-1 overflow-y-auto max-h-96">
            <h3 className="font-semibold text-gray-900 mb-3 text-sm">Issues Found</h3>
            {attention?.issues && attention.issues.length > 0 ? (
              <div className="space-y-2">
                {attention.issues.map((issue, idx) => (
                  <div key={idx} className="p-3 border border-gray-200 rounded-lg bg-gray-50">
                    <div className="flex items-start gap-2 mb-1">
                      {getSeverityIcon(issue.severity)}
                      <h4 className="font-semibold text-sm text-gray-900 flex-1">{issue.type}</h4>
                    </div>
                    <p className="text-xs text-gray-700 mt-1">{issue.description}</p>
                    {issue.recommendation && (
                      <p className="text-xs text-purple-600 mt-1 font-medium">
                        üí° {issue.recommendation}
                      </p>
                    )}
                  </div>
                ))}
              </div>
            ) : (
              <div className="text-center py-6 text-gray-500">
                <CheckCircle className="h-8 w-8 mx-auto mb-2 text-green-500" />
                <p className="text-sm">No issues found!</p>
              </div>
            )}
          </div>

          {/* Recommendations */}
          {attention?.recommendations && attention.recommendations.length > 0 && (
            <div className="mt-4 pt-4 border-t border-gray-200">
              <h3 className="font-semibold text-gray-900 mb-2 text-sm">Recommendations</h3>
              <div className="space-y-2">
                {attention.recommendations.map((rec, idx) => (
                  <div key={idx} className="p-2 bg-purple-50 border border-purple-200 rounded text-xs">
                    <p className="font-semibold text-gray-900">{typeof rec === 'object' ? rec.title : rec}</p>
                    {typeof rec === 'object' && rec.description && (
                      <p className="text-gray-700 mt-1">{rec.description}</p>
                    )}
                  </div>
                ))}
              </div>
            </div>
          )}
        </div>
        
      </div>
    </div>
  );
};

export default AnalysisResults;
